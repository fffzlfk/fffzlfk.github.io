<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>Java泛型 | fffzlfk's Blog</title><meta name=keywords content="Java"><meta name=description content="擦拭法 编译器把类型<T>视为Object public class Pair<T> { private final T first; private final T last; public Pair(T first, T last) { this.first = first; this.last = last; } public T getFirst() { return first; } public T getLast() { return last; } } Java中泛型是在编译阶段的，编译器将上述代码经过擦除法，JVM实际看到的代码如下所示：
public class Pair { private final Object first; private final Object last; public Pair(Object first, Object last) { this.first = first; this.last = last; } public Object getFirst() { return first; } public Object getLast() { return last; } } 编译器根据<T>实现安全的强制转型 Pair<String> p = new Pair<>(&#34;Hello&#34;, &#34;world&#34;); String first = p."><meta name=author content="fffzlfk"><link rel=canonical href=https://fffzlfk.github.io/posts/java%E6%B3%9B%E5%9E%8B/><link crossorigin=anonymous href=/assets/css/stylesheet.3b1cc03af9890a9e14762cb10779f50b165a8e12a4ff763213eef0019f3771fb.css integrity="sha256-OxzAOvmJCp4UdiyxB3n1CxZajhKk/3YyE+7wAZ83cfs=" rel="preload stylesheet" as=style><script defer crossorigin=anonymous src=/assets/js/highlight.ab916b8151320cc693135f5df9fe4b75e6e4754d8f0dff5782df332cacd1ba8e.js integrity="sha256-q5FrgVEyDMaTE19d+f5LdebkdU2PDf9Xgt8zLKzRuo4=" onload=hljs.initHighlightingOnLoad()></script>
<link rel=icon href=https://fffzlfk.github.io/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://fffzlfk.github.io/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://fffzlfk.github.io/favicon-32x32.png><link rel=apple-touch-icon href=https://fffzlfk.github.io/apple_touch_icon.png><link rel=mask-icon href=https://fffzlfk.github.io/favicon.ico><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--hljs-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/katex@0.15.2/dist/katex.min.css integrity=sha384-MlJdn/WNKDGXveldHDdyRP1R4CTHr3FeuDNfhsLPYrq2t0UBkUdK2jyTnXPEK1NQ crossorigin=anonymous><script defer src=https://cdn.jsdelivr.net/npm/katex@0.15.2/dist/katex.min.js integrity=sha384-VQ8d8WVFw0yHhCk5E8I86oOhv48xLpnDZx5T9GogA/Y84DcCKWXDmSDfn13bzFZY crossorigin=anonymous></script>
<script defer src=https://cdn.jsdelivr.net/npm/katex@0.15.2/dist/contrib/auto-render.min.js integrity=sha384-+XBljXPPiv+OzfbB3cVmLHf4hdUFHlWNZN5spNQ7rmHTXpd7WvJum6fIACpNNfIR crossorigin=anonymous></script>
<script>document.addEventListener("DOMContentLoaded",function(){renderMathInElement(document.body,{delimiters:[{left:"$$",right:"$$",display:!0},{left:"$",right:"$",display:!1},{left:"\\(",right:"\\)",display:!1},{left:"\\[",right:"\\]",display:!0}],throwOnError:!1})})</script><meta property="og:title" content="Java泛型"><meta property="og:description" content="擦拭法 编译器把类型<T>视为Object public class Pair<T> { private final T first; private final T last; public Pair(T first, T last) { this.first = first; this.last = last; } public T getFirst() { return first; } public T getLast() { return last; } } Java中泛型是在编译阶段的，编译器将上述代码经过擦除法，JVM实际看到的代码如下所示：
public class Pair { private final Object first; private final Object last; public Pair(Object first, Object last) { this.first = first; this.last = last; } public Object getFirst() { return first; } public Object getLast() { return last; } } 编译器根据<T>实现安全的强制转型 Pair<String> p = new Pair<>(&#34;Hello&#34;, &#34;world&#34;); String first = p."><meta property="og:type" content="article"><meta property="og:url" content="https://fffzlfk.github.io/posts/java%E6%B3%9B%E5%9E%8B/"><meta property="article:section" content="posts"><meta property="article:published_time" content="2022-08-04T22:33:37+08:00"><meta property="article:modified_time" content="2022-08-04T22:33:37+08:00"><meta property="og:site_name" content="fffzlfk's Blog"><meta name=twitter:card content="summary"><meta name=twitter:title content="Java泛型"><meta name=twitter:description content="擦拭法 编译器把类型<T>视为Object public class Pair<T> { private final T first; private final T last; public Pair(T first, T last) { this.first = first; this.last = last; } public T getFirst() { return first; } public T getLast() { return last; } } Java中泛型是在编译阶段的，编译器将上述代码经过擦除法，JVM实际看到的代码如下所示：
public class Pair { private final Object first; private final Object last; public Pair(Object first, Object last) { this.first = first; this.last = last; } public Object getFirst() { return first; } public Object getLast() { return last; } } 编译器根据<T>实现安全的强制转型 Pair<String> p = new Pair<>(&#34;Hello&#34;, &#34;world&#34;); String first = p."><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":2,"name":"Posts","item":"https://fffzlfk.github.io/posts/"},{"@type":"ListItem","position":3,"name":"Java泛型","item":"https://fffzlfk.github.io/posts/java%E6%B3%9B%E5%9E%8B/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"Java泛型","name":"Java泛型","description":"擦拭法 编译器把类型\u0026lt;T\u0026gt;视为Object public class Pair\u0026lt;T\u0026gt; { private final T first; private final T last; public Pair(T first, T last) { this.first = first; this.last = last; } public T getFirst() { return first; } public T getLast() { return last; } } Java中泛型是在编译阶段的，编译器将上述代码经过擦除法，JVM实际看到的代码如下所示：\npublic class Pair { private final Object first; private final Object last; public Pair(Object first, Object last) { this.first = first; this.last = last; } public Object getFirst() { return first; } public Object getLast() { return last; } } 编译器根据\u0026lt;T\u0026gt;实现安全的强制转型 Pair\u0026lt;String\u0026gt; p = new Pair\u0026lt;\u0026gt;(\u0026#34;Hello\u0026#34;, \u0026#34;world\u0026#34;); String first = p.","keywords":["Java"],"articleBody":"擦拭法 编译器把类型视为Object public class Pair\u003cT\u003e { private final T first; private final T last; public Pair(T first, T last) { this.first = first; this.last = last; } public T getFirst() { return first; } public T getLast() { return last; } } Java中泛型是在编译阶段的，编译器将上述代码经过擦除法，JVM实际看到的代码如下所示：\npublic class Pair { private final Object first; private final Object last; public Pair(Object first, Object last) { this.first = first; this.last = last; } public Object getFirst() { return first; } public Object getLast() { return last; } } 编译器根据实现安全的强制转型 Pair\u003cString\u003e p = new Pair\u003c\u003e(\"Hello\", \"world\"); String first = p.getFirst(); String last = p.getLast(); 编译器根据T的类型安全强转：\nPair p = new Pair(\"Hello\", \"world\"); String first = (String) p.getFirst(); String last = (String) p.getLast(); 擦拭法的局限性 不能是基本类型，因为擦除法要将其替换为Object 无法获取携带泛型的Class，因为泛型是在编译期，所以获取到的都为Pair 例如： @Test void testGetClass() { Pair p1 = new Pair\u003c\u003e(\"Hello\", \"World\"); Pair p2 = new Pair\u003c\u003e(114, 514); Class c1 = p1.getClass(); Class c2 = p2.getClass(); assertEquals(c1, c2); assertEquals(c1, Pair.class); } 不恰当的覆写方法 class Pair\u003cT\u003e { public boolean equals(T t) {} } 这是因为，定义的equals(T t)方法实际上会被擦拭成equals(Object t)，而这个方法是继承自Object的，编译器会阻止一个实际上会变成覆写的泛型方法定义。\n泛型继承 类可以继承一个泛型类。在继承了泛型类型的情况下，子类可以获取父类的泛型类型。例如：IntPair可以获取到父类的泛型类型Integer。\npublic class IntPair extends Pair\u003cInteger\u003e { public IntPair(Integer first, Integer last) { super(first, last); } } class IntPairTest { @Test void getSuperParameterizedType() { Class\u003cIntPair\u003e clazz = IntPair.class; Type t = clazz.getGenericSuperclass(); if (t instanceof ParameterizedType) { ParameterizedType pt = (ParameterizedType) t; Type[] types = pt.getActualTypeArguments(); // may have many types Type firstType = types[0]; Class\u003c?\u003e typeClass = (Class\u003c?\u003e) firstType; assertEquals(typeClass, Integer.class); } } } extends通配符 public class PairHelper { static int add(Pair\u003cNumber\u003e p) { Number first = p.getFirst(); Number last = p.getLast(); return first.intValue() + last.intValue(); } } 如上，add函数接收的参数类型为Pair，所以我们传入Pair是没有问题的；但传入Pair时，会得到一个编译错误，这是因为虽然Integer是Number的子类，但是Pair却不是Pair的子类。\n为了解决这个问题，可以使用Pair\u003c? extends Number\u003e，这样就可以接收泛型类型为Number子类的Pair类型了：\nstatic int add(Pair\u003c? extends Number\u003e p) { Number first = p.getFirst(); Number last = p.getLast(); return first.intValue() + last.intValue(); } @Test void addNumberBased() { assertEquals(579, add(new Pair\u003cInteger\u003e(123, 456))); } 读取 能够从List\u003c? extends Number\u003e中获取到Number类型，因为其包含的元素是Number类型或者Number的自类型。 不能从List\u003c? extends Number\u003e中获取到Integer类型，因为其保存的元素可能是Double。 不能从List\u003c? extends Number\u003e中获取到Double类型，因为其保存的元素可能是Integer。 写入 不能添加Number到List\u003c? extends Number\u003e中，因为其保存的元素可能是Integer或Double。 不能添加Integer到List\u003c? extends Number\u003e中，因为其保存的元素可能是Double。 不能添加Number到List\u003c? extends Number\u003e中，因为其保存的元素可能是Integer。 public class ExtendsTest { List\u003c? extends Number\u003e nums1 = new ArrayList\u003cNumber\u003e(); List\u003c? extends Number\u003e nums2 = new ArrayList\u003cInteger\u003e(); List\u003c? extends Number\u003e nums3 = new ArrayList\u003cDouble\u003e(); void get() { Number x = nums1.get(0); // Integer y = nums2.get(0); // compile error // Double z = nums3.get(0); // compile error } void set() { /* nums1.add(new Number() { @Override public int intValue() { return 0; } @Override public long longValue() { return 0; } @Override public float floatValue() { return 0; } @Override public double doubleValue() { return 0; } }); */ // compile error // nums2.add(new Integer(1)); // compile error // nums3.add(new Double(1.2)); // compile error } } super通配符 \u003c? super T\u003e 描述了通配符下界, 即具体的泛型参数需要满足条件: 泛型参数必须是 T 类型或它的父类。\n读取 我们不能保证可以从List\u003c? super Integer\u003e类型对象中读取到 Integer 类型的数据, 因为其可能是 List 类型的。 我们不能保证可以从List\u003c? super Integer\u003e类型对象中读取到 Number 类型的数据, 因为其可能是 List 类型的。 唯一能够保证的是, 我们可以从List\u003c? super Integer\u003e类型对象中获取到一个 Object 对象的实例。 写入 对于上面的例子中的 List\u003c? super Integer\u003e array 对象：\n我们可以添加 Integer 对象到 array 中, 也可以添加 Integer 的子类对象到 array 中，因为Integer及其父类都可以接受Integer的子类对象。 我们不能添加 Double/Number/Object 等不是 Integer 的子类的对象到 array 中。 extends vs super 对于List\u003c? super Integer\u003e l1： 正确的理解：? super Integer 限定的是泛型参数。令 l1 的泛型参数是 T, 则 T 是 Integer 或 Integer 的父类, 因此 Integer 或 Integer 的子类的对象就可以添加到 l1 中. 错误的理解：? super Integer限定的是插入的元素的类型, 因此只要是 Integer 或 Integer 的父类的对象都可以插入 l1 中。 对于List\u003c? extends Integer\u003e l2: 正确的理解：? extends Integer 限定的是泛型参数. 令 l2 的泛型参数是 T, 则 T 是 Integer 或 Integer 的子类, 进而我们就不能找到一个类 X, 使得 X 是泛型参数 T 的子类, 因此我们就不可以向 l2 中添加元素. 不过由于我们知道了泛型参数 T 是 Integer 或 Integer 的子类这一点, 因此我们就可以从 l2 中读取到元素(取到的元素类型是 Integer 或 Integer 的子类), 并可以存放到 Integer 中。 错误的理解：? extends Integer 限定的是插入元素的类型, 因此只要是 Integer 或 Integer 的子类的对象都可以插入 l2 中 应用：PECS PECS 原则: Producer Extends, Consumer Super\nProducer extends: 如果我们需要一个 List 提供类型为 T 的数据(即希望从 List 中读取 T 类型的数据), 那么我们需要使用 ? extends T, 例如 List\u003c? extends Integer\u003e。 但是我们不能向这个 List 添加数据。 Consumer Super: 如果我们需要一个 List 来消费 T 类型的数据(即希望将 T 类型的数据写入 List 中), 那么我们需要使用 ? super T, 例如 List\u003c? super Integer\u003e。但是这个 List 不能保证从它读取的数据的类型。 如果我们既希望读取, 也希望写入, 那么我们就必须明确地声明泛型参数的类型, 例如 List。 public class Collections { public static \u003cT\u003e void copy(List\u003c? super T\u003e dest, List\u003c? extends T\u003e src) { for (int i = 0; i \u003c src.size(); i++) { dest.set(i, src.get(i)); } } } Source code https://github.com/fffzlfk/generics_tour References https://www.liaoxuefeng.com/wiki/1252599548343744/1255945193293888 https://segmentfault.com/a/1190000008423240 ","wordCount":"655","inLanguage":"en","datePublished":"2022-08-04T22:33:37+08:00","dateModified":"2022-08-04T22:33:37+08:00","author":{"@type":"Person","name":"fffzlfk"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://fffzlfk.github.io/posts/java%E6%B3%9B%E5%9E%8B/"},"publisher":{"@type":"Organization","name":"fffzlfk's Blog","logo":{"@type":"ImageObject","url":"https://fffzlfk.github.io/favicon.ico"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://fffzlfk.github.io accesskey=h title="fffzlfk's Blog (Alt + H)"><img src=https://fffzlfk.github.io/android-chrome-512x512.png alt aria-label=logo height=35>fffzlfk's Blog</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=https://github.com/fffzlfk title=GitHub><span>GitHub</span>&nbsp;<svg fill="none" shape-rendering="geometricPrecision" stroke="currentcolor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5" viewBox="0 0 24 24" height="12" width="12"><path d="M18 13v6a2 2 0 01-2 2H5a2 2 0 01-2-2V8a2 2 0 012-2h6"/><path d="M15 3h6v6"/><path d="M10 14 21 3"/></svg></a></li><li><a href=https://fffzlfk.github.io/tags/ title=Tags><span>Tags</span></a></li><li><a href=https://fffzlfk.github.io/archives title=Archive><span>Archive</span></a></li><li><a href=https://fffzlfk.github.io/about/ title=About><span>About</span></a></li><li><a href=https://fffzlfk.github.io/search/ title="Search (Alt + /)" accesskey=/><span>Search</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><div class=breadcrumbs><a href=https://fffzlfk.github.io>Home</a>&nbsp;»&nbsp;<a href=https://fffzlfk.github.io/posts/>Posts</a></div><h1 class=post-title>Java泛型</h1><div class=post-meta><span title='2022-08-04 22:33:37 +0800 +0800'>August 4, 2022</span>&nbsp;·&nbsp;4 min&nbsp;·&nbsp;fffzlfk&nbsp;|&nbsp;<a href=https://github.com/fffzlfk/fffzlfk.github.io/blob/master/content/posts/Java%e6%b3%9b%e5%9e%8b.md rel="noopener noreferrer" target=_blank>Suggest Changes</a></div></header><div class=toc><details><summary accesskey=c title="(Alt + C)"><span class=details>Table of Contents</span></summary><div class=inner><ul><li><a href=#%e6%93%a6%e6%8b%ad%e6%b3%95 aria-label=擦拭法>擦拭法</a><ul><li><a href=#%e7%bc%96%e8%af%91%e5%99%a8%e6%8a%8a%e7%b1%bb%e5%9e%8bt%e8%a7%86%e4%b8%baobject aria-label=编译器把类型&amp;lt;T&amp;gt;视为Object>编译器把类型<code>&lt;T></code>视为Object</a></li><li><a href=#%e7%bc%96%e8%af%91%e5%99%a8%e6%a0%b9%e6%8d%aet%e5%ae%9e%e7%8e%b0%e5%ae%89%e5%85%a8%e7%9a%84%e5%bc%ba%e5%88%b6%e8%bd%ac%e5%9e%8b aria-label=编译器根据&amp;lt;T&amp;gt;实现安全的强制转型>编译器根据<code>&lt;T></code>实现安全的强制转型</a></li><li><a href=#%e6%93%a6%e6%8b%ad%e6%b3%95%e7%9a%84%e5%b1%80%e9%99%90%e6%80%a7 aria-label=擦拭法的局限性>擦拭法的局限性</a></li><li><a href=#%e6%b3%9b%e5%9e%8b%e7%bb%a7%e6%89%bf aria-label=泛型继承>泛型继承</a></li></ul></li><li><a href=#extends%e9%80%9a%e9%85%8d%e7%ac%a6 aria-label=extends通配符><code>extends</code>通配符</a><ul><li><a href=#%e8%af%bb%e5%8f%96 aria-label=读取>读取</a></li><li><a href=#%e5%86%99%e5%85%a5 aria-label=写入>写入</a></li></ul></li><li><a href=#super%e9%80%9a%e9%85%8d%e7%ac%a6 aria-label=super通配符><code>super</code>通配符</a><ul><li><a href=#%e8%af%bb%e5%8f%96-1 aria-label=读取>读取</a></li><li><a href=#%e5%86%99%e5%85%a5-1 aria-label=写入>写入</a></li></ul></li><li><a href=#extends-vs-super aria-label="extends vs super"><code>extends</code> vs <code>super</code></a><ul><li><a href=#%e5%af%b9%e4%ba%8elist-super-integer-l1 aria-label="对于List&amp;lt;? super Integer&amp;gt; l1：">对于<code>List&lt;? super Integer> l1</code>：</a></li><li><a href=#%e5%af%b9%e4%ba%8elist-extends-integer-l2 aria-label="对于List&amp;lt;? extends Integer&amp;gt; l2:">对于<code>List&lt;? extends Integer> l2:</code></a></li></ul></li><li><a href=#%e5%ba%94%e7%94%a8pecs aria-label=应用：PECS>应用：PECS</a></li><li><a href=#source-code aria-label="Source code">Source code</a></li><li><a href=#references aria-label=References>References</a></li></ul></div></details></div><div class=post-content><h2 id=擦拭法>擦拭法<a hidden class=anchor aria-hidden=true href=#擦拭法>#</a></h2><h3 id=编译器把类型t视为object>编译器把类型<code>&lt;T></code>视为Object<a hidden class=anchor aria-hidden=true href=#编译器把类型t视为object>#</a></h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>Pair</span><span style=color:#f92672>&lt;</span>T<span style=color:#f92672>&gt;</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> <span style=color:#66d9ef>final</span> T first<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> <span style=color:#66d9ef>final</span> T last<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#a6e22e>Pair</span><span style=color:#f92672>(</span>T first<span style=color:#f92672>,</span> T last<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>this</span><span style=color:#f92672>.</span><span style=color:#a6e22e>first</span> <span style=color:#f92672>=</span> first<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>this</span><span style=color:#f92672>.</span><span style=color:#a6e22e>last</span> <span style=color:#f92672>=</span> last<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> T <span style=color:#a6e22e>getFirst</span><span style=color:#f92672>()</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> first<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> T <span style=color:#a6e22e>getLast</span><span style=color:#f92672>()</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> last<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span></code></pre></div><p>Java中泛型是在编译阶段的，编译器将上述代码经过擦除法，JVM实际看到的代码如下所示：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>Pair</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> <span style=color:#66d9ef>final</span> Object first<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> <span style=color:#66d9ef>final</span> Object last<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#a6e22e>Pair</span><span style=color:#f92672>(</span>Object first<span style=color:#f92672>,</span> Object last<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>this</span><span style=color:#f92672>.</span><span style=color:#a6e22e>first</span> <span style=color:#f92672>=</span> first<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>this</span><span style=color:#f92672>.</span><span style=color:#a6e22e>last</span> <span style=color:#f92672>=</span> last<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> Object <span style=color:#a6e22e>getFirst</span><span style=color:#f92672>()</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> first<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> Object <span style=color:#a6e22e>getLast</span><span style=color:#f92672>()</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> last<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span></code></pre></div><h3 id=编译器根据t实现安全的强制转型>编译器根据<code>&lt;T></code>实现安全的强制转型<a hidden class=anchor aria-hidden=true href=#编译器根据t实现安全的强制转型>#</a></h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span>Pair<span style=color:#f92672>&lt;</span>String<span style=color:#f92672>&gt;</span> p <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> Pair<span style=color:#f92672>&lt;&gt;(</span><span style=color:#e6db74>&#34;Hello&#34;</span><span style=color:#f92672>,</span> <span style=color:#e6db74>&#34;world&#34;</span><span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>String first <span style=color:#f92672>=</span> p<span style=color:#f92672>.</span><span style=color:#a6e22e>getFirst</span><span style=color:#f92672>();</span>
</span></span><span style=display:flex><span>String last <span style=color:#f92672>=</span> p<span style=color:#f92672>.</span><span style=color:#a6e22e>getLast</span><span style=color:#f92672>();</span>
</span></span></code></pre></div><p>编译器根据T的类型安全强转：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span>Pair p <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> Pair<span style=color:#f92672>(</span><span style=color:#e6db74>&#34;Hello&#34;</span><span style=color:#f92672>,</span> <span style=color:#e6db74>&#34;world&#34;</span><span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>String first <span style=color:#f92672>=</span> <span style=color:#f92672>(</span>String<span style=color:#f92672>)</span> p<span style=color:#f92672>.</span><span style=color:#a6e22e>getFirst</span><span style=color:#f92672>();</span>
</span></span><span style=display:flex><span>String last <span style=color:#f92672>=</span> <span style=color:#f92672>(</span>String<span style=color:#f92672>)</span> p<span style=color:#f92672>.</span><span style=color:#a6e22e>getLast</span><span style=color:#f92672>();</span>
</span></span></code></pre></div><h3 id=擦拭法的局限性>擦拭法的局限性<a hidden class=anchor aria-hidden=true href=#擦拭法的局限性>#</a></h3><ul><li><code>&lt;T></code>不能是基本类型，因为擦除法要将其替换为<code>Object</code></li><li>无法获取携带泛型的<code>Class</code>，因为泛型是在编译期，所以获取到的都为<code>Pair&lt;Object></code>
例如：</li></ul><pre tabindex=0><code>@Test
void testGetClass() {
    Pair&lt;String&gt; p1 = new Pair&lt;&gt;(&#34;Hello&#34;, &#34;World&#34;);
    Pair&lt;Integer&gt; p2 = new Pair&lt;&gt;(114, 514);
    Class c1 = p1.getClass();
    Class c2 = p2.getClass();

    assertEquals(c1, c2);
    assertEquals(c1, Pair.class);
}
</code></pre><ul><li>不恰当的覆写方法</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#66d9ef>class</span> <span style=color:#a6e22e>Pair</span><span style=color:#f92672>&lt;</span>T<span style=color:#f92672>&gt;</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>boolean</span> <span style=color:#a6e22e>equals</span><span style=color:#f92672>(</span>T t<span style=color:#f92672>)</span> <span style=color:#f92672>{}</span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span></code></pre></div><p>这是因为，定义的<code>equals(T t)</code>方法实际上会被擦拭成<code>equals(Object t)</code>，而这个方法是继承自<code>Object</code>的，编译器会阻止一个实际上会变成覆写的泛型方法定义。</p><h3 id=泛型继承>泛型继承<a hidden class=anchor aria-hidden=true href=#泛型继承>#</a></h3><p>类可以继承一个泛型类。在继承了泛型类型的情况下，子类可以获取父类的泛型类型。例如：<code>IntPair</code>可以获取到父类的泛型类型<code>Integer</code>。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>IntPair</span> <span style=color:#66d9ef>extends</span> Pair<span style=color:#f92672>&lt;</span>Integer<span style=color:#f92672>&gt;</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#a6e22e>IntPair</span><span style=color:#f92672>(</span>Integer first<span style=color:#f92672>,</span> Integer last<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>super</span><span style=color:#f92672>(</span>first<span style=color:#f92672>,</span> last<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>class</span> <span style=color:#a6e22e>IntPairTest</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@Test</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>getSuperParameterizedType</span><span style=color:#f92672>()</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>        Class<span style=color:#f92672>&lt;</span>IntPair<span style=color:#f92672>&gt;</span> clazz <span style=color:#f92672>=</span> IntPair<span style=color:#f92672>.</span><span style=color:#a6e22e>class</span><span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>        Type t <span style=color:#f92672>=</span> clazz<span style=color:#f92672>.</span><span style=color:#a6e22e>getGenericSuperclass</span><span style=color:#f92672>();</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> <span style=color:#f92672>(</span>t <span style=color:#66d9ef>instanceof</span> ParameterizedType<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>            ParameterizedType pt <span style=color:#f92672>=</span> <span style=color:#f92672>(</span>ParameterizedType<span style=color:#f92672>)</span> t<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>            Type<span style=color:#f92672>[]</span> types <span style=color:#f92672>=</span> pt<span style=color:#f92672>.</span><span style=color:#a6e22e>getActualTypeArguments</span><span style=color:#f92672>();</span> <span style=color:#75715e>// may have many types
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>            Type firstType <span style=color:#f92672>=</span> types<span style=color:#f92672>[</span>0<span style=color:#f92672>];</span>
</span></span><span style=display:flex><span>            Class<span style=color:#f92672>&lt;?&gt;</span> typeClass <span style=color:#f92672>=</span> <span style=color:#f92672>(</span>Class<span style=color:#f92672>&lt;?&gt;)</span> firstType<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>            assertEquals<span style=color:#f92672>(</span>typeClass<span style=color:#f92672>,</span> Integer<span style=color:#f92672>.</span><span style=color:#a6e22e>class</span><span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span></code></pre></div><h2 id=extends通配符><code>extends</code>通配符<a hidden class=anchor aria-hidden=true href=#extends通配符>#</a></h2><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>PairHelper</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>static</span> <span style=color:#66d9ef>int</span> <span style=color:#a6e22e>add</span><span style=color:#f92672>(</span>Pair<span style=color:#f92672>&lt;</span>Number<span style=color:#f92672>&gt;</span> p<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>        Number first <span style=color:#f92672>=</span> p<span style=color:#f92672>.</span><span style=color:#a6e22e>getFirst</span><span style=color:#f92672>();</span>
</span></span><span style=display:flex><span>        Number last <span style=color:#f92672>=</span> p<span style=color:#f92672>.</span><span style=color:#a6e22e>getLast</span><span style=color:#f92672>();</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> first<span style=color:#f92672>.</span><span style=color:#a6e22e>intValue</span><span style=color:#f92672>()</span> <span style=color:#f92672>+</span> last<span style=color:#f92672>.</span><span style=color:#a6e22e>intValue</span><span style=color:#f92672>();</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span></code></pre></div><p><div class=render-image><img loading=lazy src=https://i.imgur.com/rERvLBT.png alt></div></p><p>如上，<code>add</code>函数接收的参数类型为<code>Pair&lt;Number></code>，所以我们传入<code>Pair&lt;Number></code>是没有问题的；但传入<code>Pair&lt;Integer></code>时，会得到一个编译错误，这是因为虽然<code>Integer</code>是<code>Number</code>的子类，但是<code>Pair&lt;Integer></code>却不是<code>Pair&lt;Number></code>的子类。</p><p>为了解决这个问题，可以使用<code>Pair&lt;? extends Number></code>，这样就可以接收泛型类型为<code>Number</code>子类的<code>Pair</code>类型了：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#66d9ef>static</span> <span style=color:#66d9ef>int</span> <span style=color:#a6e22e>add</span><span style=color:#f92672>(</span>Pair<span style=color:#f92672>&lt;?</span> <span style=color:#66d9ef>extends</span> Number<span style=color:#f92672>&gt;</span> p<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>    Number first <span style=color:#f92672>=</span> p<span style=color:#f92672>.</span><span style=color:#a6e22e>getFirst</span><span style=color:#f92672>();</span>
</span></span><span style=display:flex><span>    Number last <span style=color:#f92672>=</span> p<span style=color:#f92672>.</span><span style=color:#a6e22e>getLast</span><span style=color:#f92672>();</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> first<span style=color:#f92672>.</span><span style=color:#a6e22e>intValue</span><span style=color:#f92672>()</span> <span style=color:#f92672>+</span> last<span style=color:#f92672>.</span><span style=color:#a6e22e>intValue</span><span style=color:#f92672>();</span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>@Test</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>void</span> <span style=color:#a6e22e>addNumberBased</span><span style=color:#f92672>()</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>    assertEquals<span style=color:#f92672>(</span>579<span style=color:#f92672>,</span> add<span style=color:#f92672>(</span><span style=color:#66d9ef>new</span> Pair<span style=color:#f92672>&lt;</span>Integer<span style=color:#f92672>&gt;(</span>123<span style=color:#f92672>,</span> 456<span style=color:#f92672>)));</span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span></code></pre></div><h3 id=读取>读取<a hidden class=anchor aria-hidden=true href=#读取>#</a></h3><ul><li>能够从<code>List&lt;? extends Number></code>中获取到<code>Number</code>类型，因为其包含的元素是<code>Number</code>类型或者<code>Number</code>的自类型。</li><li>不能从<code>List&lt;? extends Number></code>中获取到<code>Integer</code>类型，因为其保存的元素可能是<code>Double</code>。</li><li>不能从<code>List&lt;? extends Number></code>中获取到<code>Double</code>类型，因为其保存的元素可能是<code>Integer</code>。</li></ul><h3 id=写入>写入<a hidden class=anchor aria-hidden=true href=#写入>#</a></h3><ul><li>不能添加<code>Number</code>到<code>List&lt;? extends Number></code>中，因为其保存的元素可能是<code>Integer</code>或<code>Double</code>。</li><li>不能添加<code>Integer</code>到<code>List&lt;? extends Number></code>中，因为其保存的元素可能是<code>Double</code>。</li><li>不能添加<code>Number</code>到<code>List&lt;? extends Number></code>中，因为其保存的元素可能是<code>Integer</code>。</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>ExtendsTest</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>    List<span style=color:#f92672>&lt;?</span> <span style=color:#66d9ef>extends</span> Number<span style=color:#f92672>&gt;</span> nums1 <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> ArrayList<span style=color:#f92672>&lt;</span>Number<span style=color:#f92672>&gt;();</span>
</span></span><span style=display:flex><span>    List<span style=color:#f92672>&lt;?</span> <span style=color:#66d9ef>extends</span> Number<span style=color:#f92672>&gt;</span> nums2 <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> ArrayList<span style=color:#f92672>&lt;</span>Integer<span style=color:#f92672>&gt;();</span>
</span></span><span style=display:flex><span>    List<span style=color:#f92672>&lt;?</span> <span style=color:#66d9ef>extends</span> Number<span style=color:#f92672>&gt;</span> nums3 <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> ArrayList<span style=color:#f92672>&lt;</span>Double<span style=color:#f92672>&gt;();</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>get</span><span style=color:#f92672>()</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>        Number x <span style=color:#f92672>=</span> nums1<span style=color:#f92672>.</span><span style=color:#a6e22e>get</span><span style=color:#f92672>(</span>0<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>        <span style=color:#75715e>// Integer y = nums2.get(0); // compile error
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        <span style=color:#75715e>// Double z = nums3.get(0);  // compile error
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>set</span><span style=color:#f92672>()</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>        <span style=color:#75715e>/*
</span></span></span><span style=display:flex><span><span style=color:#75715e>        nums1.add(new Number() {
</span></span></span><span style=display:flex><span><span style=color:#75715e>            @Override
</span></span></span><span style=display:flex><span><span style=color:#75715e>            public int intValue() {
</span></span></span><span style=display:flex><span><span style=color:#75715e>                return 0;
</span></span></span><span style=display:flex><span><span style=color:#75715e>            }
</span></span></span><span style=display:flex><span><span style=color:#75715e>
</span></span></span><span style=display:flex><span><span style=color:#75715e>            @Override
</span></span></span><span style=display:flex><span><span style=color:#75715e>            public long longValue() {
</span></span></span><span style=display:flex><span><span style=color:#75715e>                return 0;
</span></span></span><span style=display:flex><span><span style=color:#75715e>            }
</span></span></span><span style=display:flex><span><span style=color:#75715e>
</span></span></span><span style=display:flex><span><span style=color:#75715e>            @Override
</span></span></span><span style=display:flex><span><span style=color:#75715e>            public float floatValue() {
</span></span></span><span style=display:flex><span><span style=color:#75715e>                return 0;
</span></span></span><span style=display:flex><span><span style=color:#75715e>            }
</span></span></span><span style=display:flex><span><span style=color:#75715e>
</span></span></span><span style=display:flex><span><span style=color:#75715e>            @Override
</span></span></span><span style=display:flex><span><span style=color:#75715e>            public double doubleValue() {
</span></span></span><span style=display:flex><span><span style=color:#75715e>                return 0;
</span></span></span><span style=display:flex><span><span style=color:#75715e>            }
</span></span></span><span style=display:flex><span><span style=color:#75715e>        });
</span></span></span><span style=display:flex><span><span style=color:#75715e>         */</span> <span style=color:#75715e>// compile error
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        <span style=color:#75715e>// nums2.add(new Integer(1));    // compile error
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        <span style=color:#75715e>// nums3.add(new Double(1.2)); // compile error
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span></code></pre></div><h2 id=super通配符><code>super</code>通配符<a hidden class=anchor aria-hidden=true href=#super通配符>#</a></h2><p><code>&lt;? super T></code> 描述了通配符下界, 即具体的泛型参数需要满足条件: 泛型参数必须是 <code>T</code> 类型或它的父类。</p><h3 id=读取-1>读取<a hidden class=anchor aria-hidden=true href=#读取-1>#</a></h3><ul><li>我们不能保证可以从<code>List&lt;? super Integer></code>类型对象中读取到 <code>Integer</code> 类型的数据, 因为其可能是 <code>List&lt;Number></code> 类型的。</li><li>我们不能保证可以从<code>List&lt;? super Integer></code>类型对象中读取到 <code>Number</code> 类型的数据, 因为其可能是 <code>List&lt;Object></code> 类型的。</li><li>唯一能够保证的是, 我们可以从<code>List&lt;? super Integer></code>类型对象中获取到一个 <code>Object</code> 对象的实例。</li></ul><h3 id=写入-1>写入<a hidden class=anchor aria-hidden=true href=#写入-1>#</a></h3><p>对于上面的例子中的 <code>List&lt;? super Integer></code> array 对象：</p><ul><li>我们可以添加 <code>Integer</code> 对象到 <code>array</code> 中, 也可以添加 <code>Integer</code> 的子类对象到 <code>array</code> 中，因为<code>Integer</code>及其父类都可以接受<code>Integer</code>的子类对象。</li><li>我们不能添加 <code>Double/Number/Object</code> 等不是 <code>Integer</code> 的子类的对象到 <code>array</code> 中。</li></ul><p><div class=render-image><img loading=lazy src=https://i.imgur.com/ToEcttT.png alt></div></p><h2 id=extends-vs-super><code>extends</code> vs <code>super</code><a hidden class=anchor aria-hidden=true href=#extends-vs-super>#</a></h2><h3 id=对于list-super-integer-l1>对于<code>List&lt;? super Integer> l1</code>：<a hidden class=anchor aria-hidden=true href=#对于list-super-integer-l1>#</a></h3><ul><li>正确的理解：<code>? super Integer</code> 限定的是泛型参数。令 <code>l1</code> 的泛型参数是 <code>T</code>, 则 <code>T</code> 是 <code>Integer</code> 或 <code>Integer</code> 的父类, 因此 <code>Integer</code> 或 <code>Integer</code> 的子类的对象就可以添加到 <code>l1</code> 中.</li><li>错误的理解：<del><code>? super Integer</code>限定的是插入的元素的类型, 因此只要是 <code>Integer</code> 或 <code>Integer</code> 的父类的对象都可以插入 <code>l1</code> 中。</del></li></ul><h3 id=对于list-extends-integer-l2>对于<code>List&lt;? extends Integer> l2:</code><a hidden class=anchor aria-hidden=true href=#对于list-extends-integer-l2>#</a></h3><ul><li>正确的理解：<code>? extends Integer</code> 限定的是泛型参数. 令 <code>l2</code> 的泛型参数是 <code>T</code>, 则 <code>T</code> 是 <code>Integer</code> 或 <code>Integer</code> 的子类, 进而我们就不能找到一个类 <code>X</code>, 使得 <code>X</code> 是泛型参数 <code>T</code> 的子类, 因此我们就不可以向 <code>l2</code> 中添加元素. 不过由于我们知道了泛型参数 <code>T</code> 是 <code>Integer</code> 或 <code>Integer</code> 的子类这一点, 因此我们就可以从 <code>l2</code> 中读取到元素(取到的元素类型是 <code>Integer</code> 或 <code>Integer</code> 的子类), 并可以存放到 <code>Integer</code> 中。</li><li>错误的理解：<del><code>? extends Integer</code> 限定的是插入元素的类型, 因此只要是 <code>Integer</code> 或 <code>Integer</code> 的子类的对象都可以插入 <code>l2</code> 中</del></li></ul><h2 id=应用pecs>应用：PECS<a hidden class=anchor aria-hidden=true href=#应用pecs>#</a></h2><p><strong>PECS 原则: Producer Extends, Consumer Super</strong></p><ul><li>Producer extends: 如果我们需要一个 <code>List</code> 提供类型为 <code>T</code> 的数据(即希望从 <code>List</code> 中读取 <code>T</code> 类型的数据), 那么我们需要使用 <code>? extends T</code>, 例如 <code>List&lt;? extends Integer></code>。 但是我们不能向这个 <code>List</code> 添加数据。</li><li>Consumer Super: 如果我们需要一个 <code>List</code> 来消费 <code>T</code> 类型的数据(即希望将 <code>T</code> 类型的数据写入 <code>List</code> 中), 那么我们需要使用 <code>? super T</code>, 例如 <code>List&lt;? super Integer></code>。但是这个 <code>List</code> 不能保证从它读取的数据的类型。</li><li>如果我们既希望读取, 也希望写入, 那么我们就必须明确地声明泛型参数的类型, 例如 List。</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>Collections</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>static</span> <span style=color:#f92672>&lt;</span>T<span style=color:#f92672>&gt;</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>copy</span><span style=color:#f92672>(</span>List<span style=color:#f92672>&lt;?</span> <span style=color:#66d9ef>super</span> T<span style=color:#f92672>&gt;</span> dest<span style=color:#f92672>,</span> List<span style=color:#f92672>&lt;?</span> <span style=color:#66d9ef>extends</span> T<span style=color:#f92672>&gt;</span> src<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>for</span> <span style=color:#f92672>(</span><span style=color:#66d9ef>int</span> i <span style=color:#f92672>=</span> 0<span style=color:#f92672>;</span> i <span style=color:#f92672>&lt;</span> src<span style=color:#f92672>.</span><span style=color:#a6e22e>size</span><span style=color:#f92672>();</span> i<span style=color:#f92672>++)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>            dest<span style=color:#f92672>.</span><span style=color:#a6e22e>set</span><span style=color:#f92672>(</span>i<span style=color:#f92672>,</span> src<span style=color:#f92672>.</span><span style=color:#a6e22e>get</span><span style=color:#f92672>(</span>i<span style=color:#f92672>));</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span></code></pre></div><h2 id=source-code>Source code<a hidden class=anchor aria-hidden=true href=#source-code>#</a></h2><ul><li><a href=https://github.com/fffzlfk/generics_tour>https://github.com/fffzlfk/generics_tour</a></li></ul><h2 id=references>References<a hidden class=anchor aria-hidden=true href=#references>#</a></h2><ul><li><a href=https://www.liaoxuefeng.com/wiki/1252599548343744/1255945193293888>https://www.liaoxuefeng.com/wiki/1252599548343744/1255945193293888</a></li><li><a href=https://segmentfault.com/a/1190000008423240>https://segmentfault.com/a/1190000008423240</a></li></ul></div><footer class=post-footer><ul class=post-tags><li><a href=https://fffzlfk.github.io/tags/java/>Java</a></li></ul><nav class=paginav><a class=prev href=https://fffzlfk.github.io/posts/%E4%BD%BF%E7%94%A8rust%E5%AE%9E%E7%8E%B0helangdoge/><span class=title>« Prev</span><br><span>使用Rust实现Helang😅</span></a>
<a class=next href=https://fffzlfk.github.io/posts/cloudflare_outage_on_june_21_2022chinese/><span class=title>Next »</span><br><span>Cloudflare事故报告(中文翻译)</span></a></nav></footer><div id=disqus_thread></div><script type=application/javascript>window.disqus_config=function(){},function(){if(["localhost","127.0.0.1"].indexOf(window.location.hostname)!=-1){document.getElementById("disqus_thread").innerHTML="Disqus comments not available by default when the website is previewed locally.";return}var t=document,e=t.createElement("script");e.async=!0,e.src="//https-fffzlfk-github-io.disqus.com/embed.js",e.setAttribute("data-timestamp",+new Date),(t.head||t.body).appendChild(e)}()</script><noscript>Please enable JavaScript to view the <a href=https://disqus.com/?ref_noscript>comments powered by Disqus.</a></noscript><a href=https://disqus.com class=dsq-brlink>comments powered by <span class=logo-disqus>Disqus</span></a></article></main><footer class=footer><span>&copy; 2022 <a href=https://fffzlfk.github.io>fffzlfk's Blog</a></span>
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg></a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script><script>document.querySelectorAll("pre > code").forEach(e=>{const n=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerHTML="copy";function s(){t.innerHTML="copied!",setTimeout(()=>{t.innerHTML="copy"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),s();return}const n=document.createRange();n.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(n);try{document.execCommand("copy"),s()}catch{}o.removeRange(n)}),n.classList.contains("highlight")?n.appendChild(t):n.parentNode.firstChild==n||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t):e.parentNode.appendChild(t))})</script></body></html>