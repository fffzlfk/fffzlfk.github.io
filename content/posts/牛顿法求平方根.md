---
title: "ç‰›é¡¿æ³•æ±‚å¹³æ–¹æ ¹"
date: "2021-02-23T17:18:19+08:00"
toc: true
draft: false
summary: "Newton's method for the square root"
tags:
    - go
    - æ•°å­¦
---

## ç‰›é¡¿è¿­ä»£æ³•

![](https://files.catbox.moe/fom22v.png)

- å¦‚å›¾ï¼Œä¸€æ¡æ›²çº¿$y=f(x)$ï¼Œåœ¨$f(x_n)$å¤„ç”»ä¸€æ¡åˆ‡çº¿äº¤xè½´äºç‚¹$x_{n+1}$ï¼Œæ¥ç€åœ¨$f(x_{n+1})$å¤„ç”»åˆ‡çº¿äº¤xè½´äºç‚¹$x_{n+2}$ï¼Œç»§ç»­â€¦â€¦
- åœ¨è¿™ä¸ªè¿‡ç¨‹ä¸­äº¤ç‚¹$x_{n+m}$ä¼šæ— é™é€¼è¿‘æ›²çº¿é›¶ç‚¹ï¼Œå³å¾—åˆ°æ–¹ç¨‹$f(x) = 0$çš„è§£ã€‚

## æ±‚å¹³æ–¹æ ¹

### æ€è·¯

- å³æ±‚å‡½æ•°$f(x) = x^2 - n $çš„é›¶ç‚¹
- å¯¼å‡½æ•°$f^{'}(x) = 2x $
- åœ¨ç‚¹$(x_n, x_n^2-n)$å¤„çš„åˆ‡çº¿æ–¹ç¨‹ä¸º$y - x_n^2 + n = 2x_n (x-x_n) $ï¼Œå³$y = 2x_nx - x_n^2 - n$
- åˆ™åˆ‡çº¿ä¸xè½´çš„äº¤ç‚¹$x_{n+1}$ä¸º$$\frac {x_n^2 - n} {2x_n}$$
- é‡å¤è¿­ä»£ç›´åˆ°å¾—åˆ°ç²¾åº¦æ»¡æ„çš„å€¼

### ä»£ç å®ç°

```go
package main

import (
	"fmt"
	"math"
)

func Sqrt(x float64) float64 {
	z := 1.0
	for math.Abs(z * z - x) > 1e-12 {
		z -= (z * z - x) / (2 * z)
	}
	return z
}

func main() {
	fmt.Println(Sqrt(2))
}
```

## æ±‚kæ¬¡æ–¹æ ¹

### æ€è·¯

- $$x_{n+1} = x_{n} - \frac {f(x_n)} {f^{'}(x_n)}$$
- $$x_{n+1} = x_n - \frac {x_n(1 - nx_n^{-k})} k$$

### ä»£ç å®ç°

```go
package main

import (
	"fmt"
	"math"
)

func getRoot(x, k float64) float64 {
	z := 1.0
	for math.Abs(math.Pow(z, k) - x) > 1e-9 {
		z -= z * (1 - x * math.Pow(z, -k)) / k
	}
	return z
}

func main() {
	fmt.Println(getRoot(27, 3))
}
```

## Benchmark(vs Binary Search)

### å®ç°åŠå…¶æµ‹è¯•

```go
// sqrt.go
package sqrt

import (
	"errors"
	"math"
)

const EPSILON = 1e-8

var ErrNegativeSqrt = errors.New("cannot Sqrt negative number")

func SqrtWithNR(num float64) (float64, error) {
	if num < 0 {
		return 0, ErrNegativeSqrt
	}
	z := 1.0
	for math.Abs(z*z-num) > EPSILON {
		z -= (z*z - num) / (2 * z)
	}
	return z, nil
}

func SqrtWithBS(num float64) (float64, error) {
	if num < 0 {
		return 0, ErrNegativeSqrt
	}
	l, r := 0.0, num
	for math.Abs(l*l-num) > EPSILON {
		m := (l + r) / 2
		if m*m > num {
			r = m
		} else {
			l = m
		}
	}
	return l, nil
}
```

```go
// sqrt_test.go
package sqrt_test

import (
	"math"
	"sqrt"
	"testing"
)

func TestSqrtWithNR(t *testing.T) {
	for i := 0; i < 10; i++ {
		num := float64(i)
		if z, err := sqrt.SqrtWithNR(num); err != nil {
			t.Error(err)
		} else if math.Abs(z*z-num) > sqrt.EPSILON {
			t.Errorf("%f != %f", z*z, num)
		}
	}
}

func TestSqrtWithBS(t *testing.T) {
	for i := 0; i < 10; i++ {
		num := float64(i)
		if z, err := sqrt.SqrtWithBS(num); err != nil {
			t.Error(err)
		} else if math.Abs(z*z-num) > sqrt.EPSILON {
			t.Errorf("%f != %f", z*z, num)
		}
	}
}

func BenchmarkSqrtWithNR(b *testing.B) {
	for i := 0; i < b.N; i++ {
		sqrt.SqrtWithNR(float64(i))
	}
}

func BenchmarkSqrtWithBS(b *testing.B) {
	for i := 0; i < b.N; i++ {
		sqrt.SqrtWithBS(float64(i))
	}
}
```	

### æµ‹è¯•ç»“æœ

![](https://s2.loli.net/2022/04/21/FjW7XfCuUdV8p4e.png)

å¯ä»¥çœ‹å‡ºç‰›é¡¿æ³•ç›¸æ¯”äºäºŒåˆ†æŸ¥æ‰¾ï¼Œæ€§èƒ½è¦å¥½ï¼ğŸ¥°